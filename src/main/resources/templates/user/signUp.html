<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>RingBloom - 회원가입</title>
  <!--    JQuery GOOGLE CDN    -->
 <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <!--    MATRIALIZE CSS    -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link th:href="@{/css/materialize.css}" type="text/css" rel="stylesheet" media="screen,projection"/>
  <!--    MATRIALIZE JS    -->
  <script src="/js/materialize.js"></script>
  <!--    BASE CSS FOR GENERAL    -->
  <link th:href="@{/css/style.css}" type="text/css" rel="stylesheet" media="screen,projection"/>
  <!-- Firebase API -->
  <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-messaging.js"></script>
  <!--    BASE JS FOR GENERAL    -->
  <script src="../js/init.js"></script>
  <!--    Prograssive Web App     -->
  <link rel="manifest" href="/manifest.json">
  <link rel="shortcut icon" href="/icons/favicon.ico">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#181818">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#181818">
  <script src="/pwabuilder-sw-register.js"></script>
</head>
<body>
	<form id="frm">
		<table class="sign_up">
			<caption>회원가입</caption>
			<thead>
				<tr>
					<td colspan="3" class="check_agree">확인질문 체크</td>
				</tr>
				<tr>
					<td colspan="3" class="check_agree_textarea">
						<textarea rows="20" cols="100" readonly="readonly">
							확인질문은 패스워드 분실시 사용됩니다. 획인하셨습니까?
						</textarea>
					</td>
				</tr>
				<tr>
					<td colspan="3" class="check_agree_checkbox">
						<label>
							<input type="checkbox" id="agree_checkbox" class="filled-in"/>
							<span>확인하였습니다.</span>
						</label>
					</td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<th scope="row">닉네임(아이디)</th>
					<td>
						<input type="text" id="nickname" name="NICKNAME" class="wdp_90">
					</td>
					<td>
						<a href="#" id="nickname_checkBtn" class="btn">중복확인</a>
					</td>
				</tr>
				<tr>
					<th scope="row">이메일</th>
					<td>
						<input type="text" id="email" name="EMAIL" class="wdp_90">
					</td>
					<td></td>
				</tr>
				<tr>
					<th scope="row">비밀번호</th>
					<td>
						<input type="password" id="password" name="PASSWORD" class="wdp_90">
					</td>
					<td></td>
				</tr>
				<tr>
					<th scope="row">비밀번호 확인 질문1</th>
					<td>
						<input type="text" id="op1" name="OP1" class="wdp_90">
					</td>
					<td></td>
				</tr>
				<tr>
					<th scope="row">비밀번호 확인 답변1</th>
					<td>
						<input type="text" id="answer1" name="ANSWER1" class="wdp_90">
					</td>
					<td></td>
				</tr>
				<tr>
					<th scope="row">비밀번호 확인 질문2</th>
					<td>
						<input type="text" id="op2" name="OP2" class="wdp_90">
					</td>
					<td></td>
				</tr>
				<tr>
					<th scope="row">비밀번호 확인 답변2</th>
					<td>
						<input type="text" id="answer2" name="ANSWER2" class="wdp_90">
					</td>
					<td></td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="3">
						<a href="#" class="btn" id="signUpBtn">회원가입</a>
						<a href="#" class="btn" id="homeBtn">취소</a>
					</td>
				</tr>
			</tfoot>
		</table>
	<script type="text/javascript">
		$(document).ready(function(){
			$("#nickname_checkBtn").unbind("click").click(function(e) {
				e.preventDefault();
				fn_nicknameCheck();
			});
			$("#signUpBtn").unbind("click").click(function(e) {
				e.preventDefault();
				fn_signUp();
			});
			$("#homeBtn").unbind("click").click(function(e) {
				e.preventDefault();
				fn_moveToHome();
			});
		});
		
		function fn_nicknameCheck() {
			var nickname = $("#nickname").val();
			var userData = { "nickname" : nickname }
			
			if (nickname.length < 1) {
				alert("닉네임을 입력해 주시기 바랍니다.");
			} else {
				$.ajax({
					type : "POST",
					url : "/user/checkNickname",
					data : userData,
					dataType : "json",
					error : function(error) {
						alert("서버가 응답하지 않습니다. \n다시 시도해 주시기 바랍니다.");
					},
					success : function(result) {
						if (result == 0) {
							$("#nickname").attr("disabled", true);
							alert("사용 가능한 닉네임입니다.");
						}
						else if (result == 1) {
							alert('이미 존재하는 닉네임입니다. \n다른 닉네임를 사용해주세요');
						}
						else {
							alert("에러가 발생했습니다. \n관리자에게 문의바랍니다.");
						}
					}
				});
			}
		}
		
		function fn_signUp() {
			if ($("#agree_checkbox").prop("checked") == false) {
				alert("확인질문을 체크해주시기 바랍니다.");
			} else if ($("#nickname").val().length < 1) {
				alert("닉네임을 작성해주세요.");
			} else if ($("#email").val().length < 1) {
				alert("이메일을 작성해주세요.");
			} else if ($("#password").val().length < 1) {
				alert("비밀번호를 작성해주세요.");
			} else if ($("#op1").val().length < 1) {
				alert("비밀번호 확인 질문1을 작성해주세요.");
			} else if ($("#answer1").val().length < 1) {
				alert("비밀번호 확인 답변1을 작성해주세요.");
			} else if ($("#op2").val().length < 1) {
				alert("비밀번호 확인 질문2를 작성해주세요.");
			} else if ($("#answer2").val().length < 1) {
				alert("비밀번호 확인 답변2를 작성해주세요.");
			} else if (!$("#nickname").attr("disabled")) {
				alert("닉네임 중복체크를 해 주세요.");
			} else {
				if(window.confirm("회원가입을 하시겠습니까?")) {
					$("#nickname").attr("disabled", false);
					var form = document.getElementById('frm');
			         form.setAttribute("method", "POST");
			         form.setAttribute("action", "/user/signup");
			         form.submit();
				}
			}
		}
		
		function fn_moveToHome() {
			if (window.confirm("메인 화면으로 돌아가시겠습니까?")) {
				window.location.href="/";
			}
		}
	</script>
	</form>
</body>
</html>